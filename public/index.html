<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Audiências de Custódia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <!-- 1ª Linha: Campo de Texto -->
        <div class="row mb-3">
            <div class="col">
                <h1>Consulta de audiências de custódia</h1>
            </div>
        </div>
        
        <!-- 2ª Linha: Data Início, Data Fim, Dropdown -->
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="dataInicio" class="form-label">Data Início</label>
                    <input type="date" class="form-control" id="dataInicio">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="dataFim" class="form-label">Data Fim</label>
                    <input type="date" class="form-control" id="dataFim">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="dropdown" class="form-label">Dropdown</label>
                    <select class="form-select" id="dropdown">
                        <!-- Opções serão adicionadas aqui -->
                    </select>
                    <!-- <select class="form-select" id="dropdown">
                        <option value="700500014">1ª Vara Federal de Cascavel</option> 
                        <option value="700500011">2ª Vara Federal de Cascavel</option>
                        <option value="700200018">5ª Vara Federal de Foz do Iguaçu</option>
                    </select> -->
                </div>
            </div>
        </div>

<!-- 3ª Linha: Botão para adicionar varas selecionadas -->
        <div class="row mb-3">
            <div class="col">
                <button type="button" class="btn btn-secondary" id="adicionarVaras">Adicionar Varas</button>
            </div>
        </div>

        <!-- 4ª Linha: Campo de Selecionados -->
        <div class="row mb-3">
            <div class="col">
                <div id="selecionados">
                    <!-- Opções selecionadas aparecerão aqui -->
                </div>
            </div>
        </div>
        
        <!-- 4ª Linha: Label com Consulta Atual -->
        <div class="row mb-3">
            <div class="col">
                <label id="consultaAtual" class="form-label">Consultando {vara}</label>
            </div>
        </div>

        <!-- 5ª Linha: Labels Última e Próxima Consulta -->
        <div class="row mb-3">
            <div class="col">
                <span id="ultimaConsulta">Última consulta: {ultimaconsulta}</span> - 
                <span id="proximaConsulta">Próxima consulta: {proximaconsulta}</span>
            </div>
        </div>
        
        <!-- 6ª Linha: Botão Iniciar Consulta -->
        <div class="row mb-3">
            <div class="col">
                <button type="button" class="btn btn-primary" id="iniciarConsulta">Iniciar Consulta</button>
            </div>
        </div>
        
        <!-- 7ª Linha: Tabela de Resultados -->
        <div class="row mb-3">
            <div class="col">
                <table class="table" id="resultados">
                    <thead>
                        <tr>
                            <th scope="col">Data/Hora</th>
                            <th scope="col">Processo</th>
                            <th scope="col">Juízo/Competência</th>
                            <th scope="col">Sala</th>
                            <th scope="col">Evento/Observação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Resultados serão adicionados aqui -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 8ª Linha: Container de Aviso -->
        <div class="row">
            <div class="col">
                <div class="alert alert-warning" role="alert" id="aviso">
                    <!-- Mensagem de aviso aparecerá aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts do Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('/api/varas');
            const varasDisponiveis = await response.json();
            const dropdown = document.getElementById('dropdown');
            varasDisponiveis.forEach(group => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = group.label;
                group.options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    optgroup.appendChild(opt);
                });
                dropdown.appendChild(optgroup);
            });
        } catch (error) {
            console.error('Erro ao carregar varas disponíveis:', error);
            document.getElementById('aviso').textContent = 'Erro ao carregar varas disponíveis.';
        }
    });


    document.getElementById('iniciarConsulta').addEventListener('click', async () => {
    const dataInicio = document.getElementById('dataInicio').value;
    const dataFim = document.getElementById('dataFim').value;
    const dropdown = document.getElementById('dropdown').value;

        console.log('Dados enviados:', { dataInicio, dataFim, dropdown });

        try {
            const response = await fetch(`/api/consultar?dataInicio=${encodeURIComponent(dataInicio)}&dataFim=${encodeURIComponent(dataFim)}&dropdown=${encodeURIComponent(dropdown)}`);
            
            console.log('Resposta da API:', response);

            if (!response.ok) {
                throw new Error('Erro na requisição');
            }

            const resultados = await response.json();
            console.log('Resultados recebidos:', resultados);

            const tbody = document.querySelector('#resultados tbody');
            tbody.innerHTML = ''; // Limpa a tabela

            if (Array.isArray(resultados) && resultados.length > 0) {
                resultados.forEach(row => {
                    const tr = document.createElement('tr');
                    row.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
            } else {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 5;
                td.textContent = resultados;
                tr.appendChild(td);
                tbody.appendChild(tr);
            }

            document.getElementById('aviso').textContent = 'Consulta realizada com sucesso!';
        } catch (error) {
            console.error('Erro ao consultar:', error);
            document.getElementById('aviso').textContent = 'Erro ao realizar a consulta.';
        }
    });


    </script>
</body>
</html>
